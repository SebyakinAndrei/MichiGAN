<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style type="text/css">
        .cd-resize-img {
          position: absolute;
          top: 0;
          left: 0;
          height: 100%;
          width: 0;
          overflow: hidden;
          /* Force Hardware Acceleration in WebKit */
          transform: translateZ(0);
          backface-visibility: hidden;
        }
        .is-visible .cd-resize-img {
          width: 50%;
          /* bounce in animation of the modified image */
          animation: cd-bounce-in 0.7s;
        }
        @keyframes cd-bounce-in {
          0% {
            width: 0;
          }
          60% {
            width: 55%;
          }
          100% {
            width: 50%;
          }
        }
    </style>
</head>
<body>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>

    <form id="data">
      <fieldset>
        <div>Asset File: <input id="image_file" name="image_file[]" type="file" /></div>
        <div><input type="submit" value="Submit"></div>
      </fieldset>
    </form>



    <figure class="cd-image-container">
       <img src="static/40fc255c0dedee98a62da5b30cebf0.jpg" alt="Original Image">
       <span class="cd-image-label" data-type="original">Original</span>

       <div class="cd-resize-img"> <!-- the resizable image on top -->
          <img src="static/40fc255c0dedee98a62da5b30cebf0_compr.jpg" alt="Modified Image">
          <span class="cd-image-label" data-type="modified">Modified</span>
       </div>

       <span class="cd-handle"></span> <!-- slider handle -->
    </figure>
    <script>
        jQuery(document).ready(function($){
           //function to check if the .cd-image-container is in the viewport here
           // ...

           //make the .cd-handle element draggable and modify .cd-resize-img width according to its position
           $('.cd-image-container').each(function(){
              var actual = $(this);
              drags(actual.find('.cd-handle'), actual.find('.cd-resize-img'), actual);
           });

           //function to upadate images label visibility here
           // ...
        });

        //draggable funtionality - credits to http://css-tricks.com/snippets/jquery/draggable-without-jquery-ui/
        function drags(dragElement, resizeElement, container) {
           dragElement.on("mousedown vmousedown", function(e) {
              dragElement.addClass('draggable');
              resizeElement.addClass('resizable');

              var dragWidth = dragElement.outerWidth(),
                  xPosition = dragElement.offset().left + dragWidth - e.pageX,
                  containerOffset = container.offset().left,
                  containerWidth = container.outerWidth(),
                  minLeft = containerOffset + 10,
                  maxLeft = containerOffset + containerWidth - dragWidth - 10;

              dragElement.parents().on("mousemove vmousemove", function(e) {
                 leftValue = e.pageX + xPosition - dragWidth;

                 //constrain the draggable element to move inside its container
                 if(leftValue < minLeft ) {
                    leftValue = minLeft;
                 } else if ( leftValue > maxLeft) {
                    leftValue = maxLeft;
                 }

                 widthValue = (leftValue + dragWidth/2 - containerOffset)*100/containerWidth+'%';

                 $('.draggable').css('left', widthValue).on("mouseup vmouseup", function() {
                    $(this).removeClass('draggable');
                    resizeElement.removeClass('resizable');
                 });

                 $('.resizable').css('width', widthValue);

                 //function to upadate images label visibility here
                 // ...

              }).on("mouseup vmouseup", function(e){
                 dragElement.removeClass('draggable');
                 resizeElement.removeClass('resizable');
              });
              e.preventDefault();
           }).on("mouseup vmouseup", function(e) {
              dragElement.removeClass('draggable');
              resizeElement.removeClass('resizable');
           });
        })
    </script>
    <script>
        $(function() {

          $("form#data").submit(function(event){

            event.preventDefault();

            var url  = 'http://localhost:4000/upload';
            var image_file = $('#image_file').get(0).files[0];

            var formData = new FormData();
            formData.append("upload", image_file);

            $.ajax({
              url: url,
              type: 'POST',
              data: formData,
              async: false,
              cache: false,
              contentType: false,
              processData: false,
              success: function (status) {
                console.log(status);
                if(status != 'File extension not allowed.') {
                    let fname = $('#image_file').get(0).files[0].name
                    let ext = fname.substr(fname.lastIndexOf('.'))
                    $('#img1').attr('src', 'static/'+status+ext)
                    $('#img2').attr('src', 'static/'+status+'_compr.jpg')
                    $('.img-comp-slider').remove();
                    initComparisons();
                    $('body').append('<div id="init"></div>');
                    $('.img-comp-container').removeAttr('style');
                    //$('.img-comp-container').show();
                }
              }
            });

            return false;

          });

        });
    </script>
</body>
</html>
